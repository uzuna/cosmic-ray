# Cosmic Ray Python

ソフトエラーによって永続化データが破壊(1bit反転)するのを再現する
Rust製のライブラリCosmicRayのバインディング

## Usage

```py

def test_raybox():
    # const bytes
    text = b"test_text"

    # 書き換えたいバイト列をbytearrayにする
    # Pythonのメモリ状をRustで書き換えるため
    text2 = bytearray(text)

    # 書き換え記録を保持してくれるRayBox構造体を経由で操作を行う
    rb = RayBox()

    # アドレス0番目を書き換え
    ray = Ray(0)
    rb.attack(text2, ray)
    assert text2 == b"uest_text"

    # ランダムに書き換え
    rb.attack_random(text2)
    assert text2 != b"uest_text"

    # データを元に戻す
    rb.restore(text2)
    assert text2 == text
```

## Performance

大まかな傾向として

- Rust内で保持するためにClone実装があると更にコストがかかる
  - `test_attack_restore_offset`に対して`test_attack_restore`がx1.98
- Pythonでプリミティブでない値を使う場合には生成コストがかかる
- Pythonのランダムは結構遅い
  - `test_attack_restore_random`に対して`test_attack_restore_random_python`がx2前後の差

```txt
--------------------------------------------------------------------------------------------- benchmark: 4 tests ---------------------------------------------------------------------------------------------
Name (time in us)                          Min                 Max                Mean            StdDev              Median               IQR            Outliers  OPS (Kops/s)            Rounds  Iterations
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_attack_restore_offset             43.8000 (1.0)       81.6910 (1.0)       45.1925 (1.0)      2.9430 (1.0)       44.6300 (1.0)      0.4400 (1.0)       303;394       22.1276 (1.0)        6245           1
test_attack_restore_random             46.2600 (1.06)     118.4810 (1.45)      61.3807 (1.36)     7.3257 (2.49)      62.3400 (1.40)     0.9900 (2.25)    1685;1848       16.2918 (0.74)       6388           1
test_attack_restore                    91.1500 (2.08)     283.5110 (3.47)      94.1876 (2.08)     7.3678 (2.50)      92.6900 (2.08)     0.8710 (1.98)      350;655       10.6171 (0.48)       6679           1
test_attack_restore_random_python     111.7300 (2.55)     207.0210 (2.53)     115.8345 (2.56)     4.4356 (1.51)     114.4600 (2.56)     1.9500 (4.43)      388;468        8.6330 (0.39)       5154           1
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
```
